var ct=Object.defineProperty;var lt=(n,e,t)=>e in n?ct(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var u=(n,e,t)=>(lt(n,typeof e!="symbol"?e+"":e,t),t);import{i as ut,f as ht,h as we,j as pt,s as Oe,e as nt,k as ot,l as he,m as st,r as dt,n as q}from"../chunks/scheduler.7b1a7d3f.js";import{p as Le,t as D,b as Ne,d as B,S as Be,i as Ve,g as w,h as y,j as b,f as v,k as g,a as X,r as be,u as _e,v as Ce,w as Re,m as De,s as E,n as je,c as F,x as p,o as ze,z as ie,y as U,A as Y,B as ye,C as ke,D as at}from"../chunks/index.921a44e5.js";import{g as Se,G as ft,f as ce,T as mt,a as se,N as ve}from"../chunks/ThemeSwitcher.f3adc693.js";function gt(n,e){const t=e.token={};function s(a,r,o,l){if(e.token!==t)return;e.resolved=l;let c=e.ctx;o!==void 0&&(c=c.slice(),c[o]=l);const h=a&&(e.current=a)(c);let f=!1;e.block&&(e.blocks?e.blocks.forEach((i,k)=>{k!==r&&i&&(Le(),D(i,1,1,()=>{e.blocks[k]===i&&(e.blocks[k]=null)}),Ne())}):e.block.d(1),h.c(),B(h,1),h.m(e.mount(),e.anchor),f=!0),e.block=h,e.blocks&&(e.blocks[r]=h),f&&pt()}if(ut(n)){const a=ht();if(n.then(r=>{we(a),s(e.then,1,e.value,r),we(null)},r=>{if(we(a),s(e.catch,2,e.error,r),we(null),!e.hasCatch)throw r}),e.current!==e.pending)return s(e.pending,0),!0}else{if(e.current!==e.then)return s(e.then,1,e.value,n),!0;e.resolved=n}}function wt(n,e,t){const s=e.slice(),{resolved:a}=n;n.current===n.then&&(s[n.value]=a),n.current===n.catch&&(s[n.error]=a),n.block.p(s,t)}class C{constructor(e){u(this,"api");this.api=e}async getRequest(e){return await this.api.makeRequest("GET",e)}async postRequest(e,t,s=void 0){return await this.api.makeRequest("POST",e,t,s)}async putRequest(e,t,s=void 0){return await this.api.makeRequest("PUT",e,t,s)}async deleteRequest(e,t){return await this.api.makeRequest("DELETE",e,t)}paramsFor(e){const t=new URLSearchParams;for(let s of Object.getOwnPropertyNames(e))(e[s]||!e[s]&&typeof e[s]=="boolean")&&t.append(s,e[s].toString());return[...t].length>0?`?${t.toString()}`:""}}class yt extends C{async get(e,t){if(typeof e=="string"){const r=this.paramsFor({market:t});return await this.getRequest(`albums/${e}${r}`)}const s=this.paramsFor({ids:e,market:t});return(await this.getRequest(`albums${s}`)).albums}tracks(e,t,s,a){const r=this.paramsFor({market:t,limit:s,offset:a});return this.getRequest(`albums/${e}/tracks${r}`)}}class kt extends C{async get(e){if(typeof e=="string")return this.getRequest(`artists/${e}`);const t=this.paramsFor({ids:e});return(await this.getRequest(`artists${t}`)).artists}albums(e,t,s,a,r){const o=this.paramsFor({include_groups:t,market:s,limit:a,offset:r});return this.getRequest(`artists/${e}/albums${o}`)}topTracks(e,t){const s=this.paramsFor({market:t});return this.getRequest(`artists/${e}/top-tracks${s}`)}relatedArtists(e){return this.getRequest(`artists/${e}/related-artists`)}}class vt extends C{async get(e,t){if(typeof e=="string"){const r=this.paramsFor({market:t});return this.getRequest(`audiobooks/${e}${r}`)}const s=this.paramsFor({ids:e,market:t});return(await this.getRequest(`audiobooks${s}`)).audiobooks}getAudiobookChapters(e,t,s,a){const r=this.paramsFor({market:t,limit:s,offset:a});return this.getRequest(`audiobooks/${e}/chapters${r}`)}}class bt extends C{getCategories(e,t,s,a){const r=this.paramsFor({country:e,locale:t,limit:s,offset:a});return this.getRequest(`browse/categories${r}`)}getCategory(e,t,s){const a=this.paramsFor({country:t,locale:s});return this.getRequest(`browse/categories/${e}${a}`)}getNewReleases(e,t,s){const a=this.paramsFor({country:e,limit:t,offset:s});return this.getRequest(`browse/new-releases${a}`)}getFeaturedPlaylists(e,t,s,a,r){const o=this.paramsFor({country:e,locale:t,timestamp:s,limit:a,offset:r});return this.getRequest(`browse/featured-playlists${o}`)}getPlaylistsForCategory(e,t,s,a){const r=this.paramsFor({country:t,limit:s,offset:a});return this.getRequest(`browse/categories/${e}/playlists${r}`)}}class _t extends C{async get(e,t){if(typeof e=="string"){const r=this.paramsFor({market:t});return this.getRequest(`chapters/${e}${r}`)}const s=this.paramsFor({ids:e,market:t});return(await this.getRequest(`chapters${s}`)).chapters}}class Ct extends C{async get(e,t){if(typeof e=="string"){const r=this.paramsFor({market:t});return this.getRequest(`episodes/${e}${r}`)}const s=this.paramsFor({ids:e,market:t});return(await this.getRequest(`episodes${s}`)).episodes}}class Rt extends C{get(e){const t=this.paramsFor(e);return this.getRequest(`recommendations${t}`)}genreSeeds(){return this.getRequest("recommendations/available-genre-seeds")}}class St extends C{getAvailableMarkets(){return this.getRequest("markets")}}class Tt extends C{getPlaybackState(e,t){const s=this.paramsFor({market:e,additionalTypes:t});return this.getRequest(`me/player${s}`)}getAvailableDevices(){return this.getRequest("me/player/devices")}getCurrentlyPlayingTrack(e,t){const s=this.paramsFor({market:e,additionalTypes:t});return this.getRequest(`me/player/currently-playing${s}`)}getRecentlyPlayedTracks(e,t){const s={limit:e};t&&(t.type==="before"?s.before=t.timestamp:t.type==="after"&&(s.after=t.timestamp));const a=this.paramsFor(s);return this.getRequest(`me/player/recently-played${a}`)}getUsersQueue(){return this.getRequest("me/player/queue")}async transferPlayback(e,t){if(e.length>1)throw new Error("Although an array is accepted, only a single device_id is currently supported. Supplying more than one will return 400 Bad Request");await this.putRequest("me/player",{device_ids:e,play:t})}async startResumePlayback(e,t,s,a,r){const o=this.paramsFor({device_id:e});await this.putRequest(`me/player/play${o}`,{context_uri:t,uris:s,offset:a,positionMs:r})}async pausePlayback(e){const t=this.paramsFor({device_id:e});await this.putRequest(`me/player/pause${t}`)}async skipToNext(e){const t=this.paramsFor({device_id:e});await this.postRequest(`me/player/next${t}`)}async skipToPrevious(e){const t=this.paramsFor({device_id:e});await this.postRequest(`me/player/previous${t}`)}async seekToPosition(e,t){const s=this.paramsFor({position_ms:e,device_id:t});await this.putRequest(`me/player/seek${s}`)}async setRepeatMode(e,t){const s=this.paramsFor({state:e,device_id:t});await this.putRequest(`me/player/repeat${s}`)}async setPlaybackVolume(e,t){const s=this.paramsFor({volume_percent:e,device_id:t});await this.putRequest(`me/player/volume${s}`)}async togglePlaybackShuffle(e,t){const s=this.paramsFor({state:e,device_id:t});await this.putRequest(`me/player/shuffle${s}`)}async addItemToPlaybackQueue(e,t){const s=this.paramsFor({uri:e,device_id:t});await this.postRequest(`me/player/queue${s}`)}}class xt extends C{getPlaylist(e,t,s,a){const r=this.paramsFor({market:t,fields:s,additional_types:a});return this.getRequest(`playlists/${e}${r}`)}getPlaylistItems(e,t,s,a,r,o){const l=this.paramsFor({market:t,fields:s,limit:a,offset:r,additional_types:o});return this.getRequest(`playlists/${e}/tracks${l}`)}async changePlaylistDetails(e,t){await this.putRequest(`playlists/${e}`,t)}movePlaylistItems(e,t,s,a){return this.updatePlaylistItems(e,{range_start:t,range_length:s,insert_before:a})}updatePlaylistItems(e,t){return this.putRequest(`playlists/${e}/tracks`,t)}async addItemsToPlaylist(e,t,s){await this.postRequest(`playlists/${e}/tracks`,{position:s,uris:t})}async removeItemsFromPlaylist(e,t){await this.deleteRequest(`playlists/${e}/tracks`,t)}getUsersPlaylists(e,t,s){const a=this.paramsFor({limit:t,offset:s});return this.getRequest(`users/${e}/playlists${a}`)}createPlaylist(e,t){return this.postRequest(`users/${e}/playlists`,t)}getPlaylistCoverImage(e){return this.getRequest(`playlists/${e}/images`)}async addCustomPlaylistCoverImage(e,t){let s="";if(t instanceof Buffer)s=t.toString("base64");else if(t instanceof HTMLCanvasElement)s=t.toDataURL("image/jpeg").split(";base64,")[1];else if(t instanceof HTMLImageElement){const a=document.createElement("canvas");a.width=t.width,a.height=t.height;const r=a.getContext("2d");if(!r)throw new Error("Could not get canvas context");r.drawImage(t,0,0),s=a.toDataURL("image/jpeg").split(";base64,")[1]}else if(typeof t=="string")s=t;else throw new Error("ImageData must be a Buffer, HTMLImageElement, HTMLCanvasElement, or string containing a base64 encoded jpeg");await this.addCustomPlaylistCoverImageFromBase64String(e,s)}async addCustomPlaylistCoverImageFromBase64String(e,t){await this.putRequest(`playlists/${e}/images`,t,"image/jpeg")}}class qt extends C{async execute(e,t,s,a,r,o){const l=this.paramsFor({q:e,type:t,market:s,limit:a,offset:r,include_external:o});return await this.getRequest(`search${l}`)}}class $t extends C{async get(e,t){if(typeof e=="string"){const r=this.paramsFor({market:t});return this.getRequest(`shows/${e}${r}`)}const s=this.paramsFor({ids:e,market:t});return(await this.getRequest(`shows${s}`)).shows}episodes(e,t,s,a){const r=this.paramsFor({market:t,limit:s,offset:a});return this.getRequest(`shows/${e}/episodes${r}`)}}class Et extends C{async get(e,t){if(typeof e=="string"){const r=this.paramsFor({market:t});return this.getRequest(`tracks/${e}${r}`)}const s=this.paramsFor({ids:e,market:t});return(await this.getRequest(`tracks${s}`)).tracks}async audioFeatures(e){if(typeof e=="string")return this.getRequest(`audio-features/${e}`);const t=this.paramsFor({ids:e});return(await this.getRequest(`audio-features${t}`)).audio_features}audioAnalysis(e){return this.getRequest(`audio-analysis/${e}`)}}const Me={access_token:"",token_type:"",expires_in:0,refresh_token:"",expires:0};class Ft extends C{profile(e){return this.getRequest(`users/${e}`)}}class At extends C{constructor(t){super(t);u(this,"albums");u(this,"audiobooks");u(this,"episodes");u(this,"playlists");u(this,"shows");u(this,"tracks");this.albums=new Pt(t),this.audiobooks=new It(t),this.episodes=new Ut(t),this.playlists=new Ot(t),this.shows=new Lt(t),this.tracks=new Nt(t)}profile(){return this.getRequest("me")}topItems(t,s,a,r){const o=this.paramsFor({time_range:s,limit:a,offset:r});return this.getRequest(`me/top/${t}${o}`)}followedArtists(t,s){const a=this.paramsFor({type:"artist",after:t,limit:s});return this.getRequest(`me/following${a}`)}async followArtistsOrUsers(t,s){const a=this.paramsFor({type:s});await this.putRequest(`me/following${a}`,{ids:t})}async unfollowArtistsOrUsers(t,s){const a=this.paramsFor({type:s});await this.deleteRequest(`me/following${a}`,{ids:t})}followsArtistsOrUsers(t,s){const a=this.paramsFor({ids:t,type:s});return this.getRequest(`me/following/contains${a}`)}}class Pt extends C{savedAlbums(e,t,s){const a=this.paramsFor({limit:e,offset:t,market:s});return this.getRequest(`me/albums${a}`)}async saveAlbums(e){await this.putRequest("me/albums",e)}async removeSavedAlbums(e){await this.deleteRequest("me/albums",e)}hasSavedAlbums(e){const t=this.paramsFor({ids:e});return this.getRequest(`me/albums/contains${t}`)}}class It extends C{savedAudiobooks(e,t){const s=this.paramsFor({limit:e,offset:t});return this.getRequest(`me/audiobooks${s}`)}async saveAudiobooks(e){await this.putRequest("me/audiobooks",e)}async removeSavedAudiobooks(e){await this.deleteRequest("me/audiobooks",e)}hasSavedAudiobooks(e){const t=this.paramsFor({ids:e});return this.getRequest(`me/audiobooks/contains${t}`)}}class Ut extends C{savedEpisodes(e,t,s){const a=this.paramsFor({market:e,limit:t,offset:s});return this.getRequest(`me/episodes${a}`)}async saveEpisodes(e){await this.putRequest("me/episodes",e)}async removeSavedEpisodes(e){await this.deleteRequest("me/episodes",e)}hasSavedEpisodes(e){const t=this.paramsFor({ids:e});return this.getRequest(`me/episodes/contains${t}`)}}class Ot extends C{playlists(e,t){const s=this.paramsFor({limit:e,offset:t});return this.getRequest(`me/playlists${s}`)}async follow(e){await this.putRequest(`playlists/${e}/followers`)}async unfollow(e){await this.deleteRequest(`playlists/${e}/followers`)}isFollowing(e,t){const s=this.paramsFor({ids:t});return this.getRequest(`playlists/${e}/followers/contains${s}`)}}class Lt extends C{savedShows(e,t){const s=this.paramsFor({limit:e,offset:t});return this.getRequest(`me/shows${s}`)}saveShows(e){const t=this.paramsFor({ids:e});return this.putRequest(`me/shows${t}`)}removeSavedShows(e,t){const s=this.paramsFor({ids:e,market:t});return this.deleteRequest(`me/shows${s}`)}hasSavedShow(e){const t=this.paramsFor({ids:e});return this.getRequest(`me/shows/contains${t}`)}}class Nt extends C{savedTracks(e,t,s){const a=this.paramsFor({limit:e,offset:t,market:s});return this.getRequest(`me/tracks${a}`)}async saveTracks(e){await this.putRequest("me/tracks",e)}async removeSavedTracks(e){await this.deleteRequest("me/tracks",e)}hasSavedTracks(e){const t=this.paramsFor({ids:e});return this.getRequest(`me/tracks/contains${t}`)}}class Bt{static get current(){return this.hasSubtleCrypto?window.crypto:this.tryLoadNodeWebCrypto()}static get hasSubtleCrypto(){return typeof window<"u"&&typeof window.crypto<"u"&&typeof window.crypto.subtle<"u"}static tryLoadNodeWebCrypto(){try{const{webcrypto:e}=require("crypto");return e}catch(e){throw e}}}class N{static async refreshCachedAccessToken(e,t){const s=await N.refreshToken(e,t.refresh_token);return N.toCachable(s)}static toCachable(e){return{...e,expires:Date.now()+e.expires_in*1e3}}static async refreshToken(e,t){const s=new URLSearchParams;s.append("client_id",e),s.append("grant_type","refresh_token"),s.append("refresh_token",t);const a=await fetch("https://accounts.spotify.com/api/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:s}),r=await a.text();if(!a.ok)throw new Error(`Failed to refresh token: ${a.statusText}, ${r}`);return JSON.parse(r)}static generateCodeVerifier(e){let t="",s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let a=0;a<e;a++)t+=s.charAt(Math.floor(Math.random()*s.length));return t}static async generateCodeChallenge(e){const t=new TextEncoder().encode(e),s=await Bt.current.subtle.digest("SHA-256",t),a=[...new Uint8Array(s)];return(typeof Buffer<"u"?Buffer.from(s).toString("base64"):btoa(String.fromCharCode.apply(null,a))).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}static get crypto(){return this.hasSubtleCrypto?window.crypto:this.tryLoadNodeWebCrypto()}static get hasSubtleCrypto(){return typeof window<"u"&&typeof window.crypto<"u"&&typeof window.crypto.subtle<"u"}static tryLoadNodeWebCrypto(){try{const{webcrypto:e}=require("crypto");return e}catch(e){throw e}}}const ae=class ae{constructor(e,t,s=[]){u(this,"clientId");u(this,"clientSecret");u(this,"scopes");u(this,"configuration",null);this.clientId=e,this.clientSecret=t,this.scopes=s}get cache(){return this.configuration.cachingStrategy}setConfiguration(e){this.configuration=e}async getOrCreateAccessToken(){return await this.cache.getOrCreate(ae.cacheKey,async()=>{const t=await this.getTokenFromApi();return N.toCachable(t)})}async getAccessToken(){return await this.cache.get(ae.cacheKey)}removeAccessToken(){this.cache.remove(ae.cacheKey)}async getTokenFromApi(){const e={grant_type:"client_credentials",scope:this.scopes.join(" ")},t=Object.keys(e).map(c=>c+"="+e[c]).join("&"),s=typeof Buffer<"u",a=`${this.clientId}:${this.clientSecret}`,r=s?Buffer.from(a).toString("base64"):btoa(a),o=await fetch("https://accounts.spotify.com/api/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded",Authorization:`Basic ${r}`},body:t});if(o.status!==200)throw new Error("Failed to get access token.");return await o.json()}};u(ae,"cacheKey","spotify-sdk:ClientCredentialsStrategy:token");let Ae=ae;const re=class re{constructor(e,t,s){u(this,"clientId");u(this,"redirectUri");u(this,"scopes");u(this,"configuration",null);this.clientId=e,this.redirectUri=t,this.scopes=s}get cache(){return this.configuration.cachingStrategy}setConfiguration(e){this.configuration=e}async getOrCreateAccessToken(){return await this.cache.getOrCreate(re.cacheKey,async()=>{const t=await this.redirectOrVerifyToken();return N.toCachable(t)},async t=>N.refreshCachedAccessToken(this.clientId,t))}async getAccessToken(){return await this.cache.get(re.cacheKey)}removeAccessToken(){this.cache.remove(re.cacheKey)}async redirectOrVerifyToken(){const e=new URLSearchParams(window.location.hash.substring(1)),t=e.get("access_token");if(t)return Promise.resolve({access_token:t,token_type:e.get("token_type")??"",expires_in:parseInt(e.get("expires_in")??"0"),refresh_token:e.get("refresh_token")??"",expires:Number(e.get("expires"))||0});var a=(this.scopes??[]).join(" ");const r=new URLSearchParams;r.append("client_id",this.clientId),r.append("response_type","token"),r.append("redirect_uri",this.redirectUri),r.append("scope",a);const o="https://accounts.spotify.com/authorize?"+r.toString();return this.configuration.redirectionStrategy.redirect(o),Me}};u(re,"cacheKey","spotify-sdk:ImplicitGrantStrategy:token");let Pe=re;const ne=class ne{constructor(e,t,s){u(this,"clientId");u(this,"redirectUri");u(this,"scopes");u(this,"configuration",null);this.clientId=e,this.redirectUri=t,this.scopes=s}get cache(){return this.configuration.cachingStrategy}setConfiguration(e){this.configuration=e}async getOrCreateAccessToken(){return await this.cache.getOrCreate(ne.cacheKey,async()=>{const t=await this.redirectOrVerifyToken();return N.toCachable(t)},async t=>N.refreshCachedAccessToken(this.clientId,t))}async getAccessToken(){return await this.cache.get(ne.cacheKey)}removeAccessToken(){this.cache.remove(ne.cacheKey)}async redirectOrVerifyToken(){const t=new URLSearchParams(window.location.search).get("code");if(!t){const r=N.generateCodeVerifier(128),o=await N.generateCodeChallenge(r),l={verifier:r,expiresOnAccess:!0};this.cache.setCacheItem("spotify-sdk:verifier",l);const c=await this.generateRedirectUrlForUser(this.scopes,o);return await this.configuration.redirectionStrategy.redirect(c),Me}this.removeCodeFromUrl();const s=await this.cache.get("spotify-sdk:verifier"),a=s==null?void 0:s.verifier;if(!a)throw new Error("No verifier found in cache - can't validate query string callback parameters.");return await this.configuration.redirectionStrategy.onReturnFromRedirect(),await this.exchangeCodeForToken(t,a)}removeCodeFromUrl(){const e=new URL(window.location.href);e.searchParams.delete("code");const t=e.search?e.href:e.href.replace("?","");window.history.replaceState({},document.title,t)}async generateRedirectUrlForUser(e,t){const s=e.join(" "),a=new URLSearchParams;return a.append("client_id",this.clientId),a.append("response_type","code"),a.append("redirect_uri",this.redirectUri),a.append("scope",s),a.append("code_challenge_method","S256"),a.append("code_challenge",t),`https://accounts.spotify.com/authorize?${a.toString()}`}async exchangeCodeForToken(e,t){const s=new URLSearchParams;s.append("client_id",this.clientId),s.append("grant_type","authorization_code"),s.append("code",e),s.append("redirect_uri",this.redirectUri),s.append("code_verifier",t);const a=await fetch("https://accounts.spotify.com/api/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:s}),r=await a.text();if(!a.ok)throw new Error(`Failed to exchange code for token: ${a.statusText}, ${r}`);return JSON.parse(r)}};u(ne,"cacheKey","spotify-sdk:AuthorizationCodeWithPKCEStrategy:token");let Te=ne;class Vt{async deserialize(e){const t=await e.text();return t.length>0?JSON.parse(t):null}}class Dt{async validateResponse(e){switch(e.status){case 401:throw new Error("Bad or expired token. This can happen if the user revoked a token or the access token has expired. You should re-authenticate the user.");case 403:const t=await e.text();throw new Error(`Bad OAuth request (wrong consumer key, bad nonce, expired timestamp...). Unfortunately, re-authenticating the user won't help here. Body: ${t}`);case 429:throw new Error("The app has exceeded its rate limits.");default:if(!e.status.toString().startsWith("20")){const s=await e.text();throw new Error(`Unrecognised response code: ${e.status} - ${e.statusText}. Body: ${s}`)}}}}class jt{async handleErrors(e){return!1}}class zt{async redirect(e){document.location=e.toString()}async onReturnFromRedirect(){}}class it{constructor(e,t=new Map,s=0,a=2*60*1e3){u(this,"storage");u(this,"updateFunctions");u(this,"autoRenewInterval");u(this,"autoRenewWindow");this.storage=e,this.updateFunctions=t,this.autoRenewInterval=s,this.autoRenewWindow=a,this.autoRenewInterval>0&&setInterval(()=>this.autoRenewRenewableItems(),this.autoRenewInterval)}async getOrCreate(e,t,s){s&&this.updateFunctions.set(e,s);const a=await this.get(e);if(a)return a;const r=await t();if(!r)throw new Error("Could not create cache item");return this.setCacheItem(e,r),r}async get(e){let t=this.storage.get(e),s=t?JSON.parse(t):null;if(this.itemDueToExpire(s)&&this.updateFunctions.has(e)){const a=this.updateFunctions.get(e);await this.tryUpdateItem(e,s,a),t=this.storage.get(e),s=t?JSON.parse(t):null}return s?s.expires&&(s.expires===-1||s.expires<=Date.now())?(this.remove(e),null):(s.expiresOnAccess&&s.expiresOnAccess===!0&&this.remove(e),s):null}set(e,t,s){const a=Date.now()+s,r={...t,expires:a};this.setCacheItem(e,r)}setCacheItem(e,t){const s=JSON.stringify(t);this.storage.set(e,s)}remove(e){this.storage.remove(e)}itemDueToExpire(e){return!e||!e.expires?!1:e.expires-Date.now()<this.autoRenewWindow}async autoRenewRenewableItems(){this.updateFunctions.forEach(async(e,t)=>{const s=await this.get(t);s&&e&&this.itemDueToExpire(s)&&await this.tryUpdateItem(t,s,e)})}async tryUpdateItem(e,t,s){try{const a=await s(t);a&&this.setCacheItem(e,a)}catch(a){console.error(a)}}}class Mt extends it{constructor(){super(new Ht)}}class Ht{get(e){return localStorage.getItem(e)}set(e,t){localStorage.setItem(e,t)}remove(e){localStorage.removeItem(e)}}class Jt extends it{constructor(){super(new Gt)}}class Gt{constructor(){u(this,"cache",new Map)}get(e){return this.cache.get(e)??null}set(e,t){this.cache.set(e,t)}remove(e){this.cache.delete(e)}}const oe=class oe{constructor(e,t){u(this,"clientId");u(this,"accessToken");u(this,"configuration",null);this.clientId=e,this.accessToken=t}get cache(){return this.configuration.cachingStrategy}setConfiguration(e){this.configuration=e}async getOrCreateAccessToken(){return this.accessToken=await this.cache.getOrCreate(oe.cacheKey,async()=>{const e=N.toCachable(this.accessToken);return Promise.resolve(e)},async e=>N.refreshCachedAccessToken(this.clientId,e)),this.accessToken}async getAccessToken(){return await this.cache.get(oe.cacheKey)}removeAccessToken(){this.cache.remove(oe.cacheKey)}};u(oe,"cacheKey","spotify-sdk:ProvidedAccessTokenStrategy:token");let Ie=oe;const Z=class Z{constructor(e,t){u(this,"sdkConfig");u(this,"authenticationStrategy");u(this,"albums");u(this,"artists");u(this,"audiobooks");u(this,"browse");u(this,"chapters");u(this,"episodes");u(this,"recommendations");u(this,"markets");u(this,"player");u(this,"playlists");u(this,"shows");u(this,"tracks");u(this,"users");u(this,"search");u(this,"currentUser");this.sdkConfig=this.initilizeSdk(t),this.albums=new yt(this),this.artists=new kt(this),this.audiobooks=new vt(this),this.browse=new bt(this),this.chapters=new _t(this),this.episodes=new Ct(this),this.recommendations=new Rt(this),this.markets=new St(this),this.player=new Tt(this),this.playlists=new xt(this),this.shows=new $t(this),this.tracks=new Et(this),this.users=new Ft(this),this.currentUser=new At(this);const s=new qt(this);this.search=s.execute.bind(s),this.authenticationStrategy=e,this.authenticationStrategy.setConfiguration(this.sdkConfig)}async makeRequest(e,t,s=void 0,a=void 0){try{const r=await this.authenticationStrategy.getOrCreateAccessToken(),o=r==null?void 0:r.access_token,l=Z.rootUrl+t,c={method:e,headers:{Authorization:`Bearer ${o}`,"Content-Type":a??"application/json"},body:s?typeof s=="string"?s:JSON.stringify(s):void 0};this.sdkConfig.beforeRequest(l,c);const h=await this.sdkConfig.fetch(l,c);return this.sdkConfig.afterRequest(l,c,h),h.status===204?null:(await this.sdkConfig.responseValidator.validateResponse(h),this.sdkConfig.deserializer.deserialize(h))}catch(r){if(!await this.sdkConfig.errorHandler.handleErrors(r))throw r;return null}}initilizeSdk(e){const t=typeof window<"u";return{...{fetch:(a,r)=>fetch(a,r),beforeRequest:(a,r)=>{},afterRequest:(a,r,o)=>{},deserializer:new Vt,responseValidator:new Dt,errorHandler:new jt,redirectionStrategy:new zt,cachingStrategy:t?new Mt:new Jt},...e}}switchAuthenticationStrategy(e){this.authenticationStrategy=e,this.authenticationStrategy.setConfiguration(this.sdkConfig),this.authenticationStrategy.getOrCreateAccessToken()}async authenticate(){return this.authenticationStrategy.getOrCreateAccessToken()}async getAccessToken(){return this.authenticationStrategy.getAccessToken()}logOut(){this.authenticationStrategy.removeAccessToken()}static withUserAuthorization(e,t,s=[],a){const r=new Te(e,t,s);return new Z(r,a)}static withClientCredentials(e,t,s=[],a){const r=new Ae(e,t,s);return new Z(r,a)}static withImplicitGrant(e,t,s=[],a){const r=new Pe(e,t,s);return new Z(r,a)}static withAccessToken(e,t,s){const a=new Ie(e,t);return new Z(a,s)}static async performUserAuthorization(e,t,s,a,r){const o=new Te(e,t,s),c=await new Z(o,r).authenticationStrategy.getOrCreateAccessToken();if(JSON.stringify({...c,expires:0})!==JSON.stringify(Me)){if(typeof a=="string"){await fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)});return}await a(c)}}};u(Z,"rootUrl","https://api.spotify.com/v1/");let Ue=Z;function Kt(n){let e,t,s;return t=new ft({props:{data:n[0],nodeStyle:n[2]}}),{c(){e=w("div"),be(t.$$.fragment),this.h()},l(a){e=y(a,"DIV",{class:!0});var r=b(e);_e(t.$$.fragment,r),r.forEach(v),this.h()},h(){g(e,"class","w-full h-full z-0")},m(a,r){X(a,e,r),Ce(t,e,null),s=!0},p(a,r){const o={};r&1&&(o.data=a[0]),r&4&&(o.nodeStyle=a[2]),t.$set(o)},i(a){s||(B(t.$$.fragment,a),s=!0)},o(a){D(t.$$.fragment,a),s=!1},d(a){a&&v(e),Re(t)}}}function Wt(n){let e,t,s,a=n[1].text+"",r,o,l,c,h,f;return{c(){e=w("div"),t=w("div"),s=w("p"),r=De(a),o=E(),l=w("progress"),this.h()},l(i){e=y(i,"DIV",{class:!0});var k=b(e);t=y(k,"DIV",{class:!0});var d=b(t);s=y(d,"P",{class:!0});var m=b(s);r=je(m,a),m.forEach(v),o=F(d),l=y(d,"PROGRESS",{class:!0,max:!0}),b(l).forEach(v),d.forEach(v),k.forEach(v),this.h()},h(){g(s,"class","text-lg font-bold"),g(l,"class","progress w-56"),l.value=c=n[1].percentage,g(l,"max","100"),g(t,"class","text-center space-y-3"),g(e,"class","absolute top-0 left-0 z-10 w-screen h-screen flex justify-center items-center bg-base-100")},m(i,k){X(i,e,k),p(e,t),p(t,s),p(s,r),p(t,o),p(t,l),f=!0},p(i,k){(!f||k&2)&&a!==(a=i[1].text+"")&&ze(r,a),(!f||k&2&&c!==(c=i[1].percentage))&&(l.value=c)},i(i){f||(i&&he(()=>{f&&(h||(h=ie(e,ce,{delay:100,duration:500},!0)),h.run(1))}),f=!0)},o(i){i&&(h||(h=ie(e,ce,{delay:100,duration:500},!1)),h.run(0)),f=!1},d(i){i&&v(e),i&&h&&h.end()}}}function Zt(n){let e,t,s,a;const r=[Wt,Kt],o=[];function l(c,h){return c[1]?0:1}return t=l(n),s=o[t]=r[t](n),{c(){e=w("div"),s.c(),this.h()},l(c){e=y(c,"DIV",{class:!0});var h=b(e);s.l(h),h.forEach(v),this.h()},h(){g(e,"class","relative")},m(c,h){X(c,e,h),o[t].m(e,null),a=!0},p(c,[h]){let f=t;t=l(c),t===f?o[t].p(c,h):(Le(),D(o[f],1,1,()=>{o[f]=null}),Ne(),s=o[t],s?s.p(c,h):(s=o[t]=r[t](c),s.c()),B(s,1),s.m(e,null))},i(c){a||(B(s),a=!0)},o(c){D(s),a=!1},d(c){c&&v(e),o[t].d()}}}function Qt(n,e,t){let s;nt(n,Se,d=>t(5,s=d));let{sdk:a}=e,{data:r}=e,{loading:o}=e,{graphType:l}=e,{nodeStyle:c}=e;const h=async d=>{const m=d.map(A=>A.id),T=80/m.length;let _=[];for(const A of d){const le=await a.artists.relatedArtists(A.id);o&&t(1,o.percentage+=T,o);for(const x of le.artists)m.includes(x.id)&&!_.includes({source:x.id,target:A.id})&&!_.includes({source:A.id,target:x.id})&&_.push({source:A.id,target:x.id})}return _},f=async d=>{var T,_;const m=(await a.currentUser.followedArtists(d,50)).artists;return(T=m==null?void 0:m.cursors)!=null&&T.after?m.items.concat(await f((_=m==null?void 0:m.cursors)==null?void 0:_.after)):m.items},i=async(d="short")=>{switch(d){case"short_term":case"medium_term":case"long_term":return(await a.currentUser.topItems("artists",d,50)).items;case"following":return await f();case"all":return(await i("short_term")).concat(await i("medium_term")).concat(await i("long_term")).concat(await i("following"));default:return i("medium_term")}},k=async d=>{try{t(1,o={text:"Downloading Artists",percentage:10});const m=await i(d);t(1,o={text:"Building Links",percentage:20});const T=await h(m);t(1,o=null),t(0,r={nodes:m,links:T})}catch(m){ot(Se,s=m,s)}};return n.$$set=d=>{"sdk"in d&&t(3,a=d.sdk),"data"in d&&t(0,r=d.data),"loading"in d&&t(1,o=d.loading),"graphType"in d&&t(4,l=d.graphType),"nodeStyle"in d&&t(2,c=d.nodeStyle)},n.$$.update=()=>{n.$$.dirty&16&&k(l)},[r,o,c,a,l]}class Yt extends Be{constructor(e){super(),Ve(this,e,Qt,Zt,Oe,{sdk:3,data:0,loading:1,graphType:4,nodeStyle:2})}}function Xt(n){let e,t=n[0].display_name+"",s;return{c(){e=w("span"),s=De(t)},l(a){e=y(a,"SPAN",{});var r=b(e);s=je(r,t),r.forEach(v)},m(a,r){X(a,e,r),p(e,s)},p(a,r){r&1&&t!==(t=a[0].display_name+"")&&ze(s,t)},d(a){a&&v(e)}}}function es(n){let e,t;return{c(){e=w("img"),this.h()},l(s){e=y(s,"IMG",{src:!0,alt:!0}),this.h()},h(){var s;st(e.src,t=(s=n[0].images)==null?void 0:s.slice(-1)[0].url)||g(e,"src",t),g(e,"alt","profile")},m(s,a){X(s,e,a)},p(s,a){var r;a&1&&!st(e.src,t=(r=s[0].images)==null?void 0:r.slice(-1)[0].url)&&g(e,"src",t)},d(s){s&&v(e)}}}function ts(n){let e,t,s,a,r,o,l;function c(i,k){var d,m;return((m=(d=i[0])==null?void 0:d.images)==null?void 0:m.length)>0?es:Xt}let h=c(n),f=h(n);return{c(){e=w("div"),t=w("div"),s=w("a"),f.c(),this.h()},l(i){e=y(i,"DIV",{class:!0,"data-tip":!0});var k=b(e);t=y(k,"DIV",{class:!0});var d=b(t);s=y(d,"A",{class:!0,href:!0,target:!0,rel:!0});var m=b(s);f.l(m),m.forEach(v),d.forEach(v),k.forEach(v),this.h()},h(){g(s,"class","w-12 rounded-full ring ring-primary ring-offset-base-100 ring-offset-2 overflow-hidden"),g(s,"href",a=n[0].external_urls.spotify),g(s,"target","_blank"),g(s,"rel","noreferrer noopener"),g(t,"class","avatar"),g(e,"class","tooltip tooltip-bottom select-none"),g(e,"data-tip",r=n[0].display_name)},m(i,k){X(i,e,k),p(e,t),p(t,s),f.m(s,null),l=!0},p(i,[k]){h===(h=c(i))&&f?f.p(i,k):(f.d(1),f=h(i),f&&(f.c(),f.m(s,null))),(!l||k&1&&a!==(a=i[0].external_urls.spotify))&&g(s,"href",a),(!l||k&1&&r!==(r=i[0].display_name))&&g(e,"data-tip",r)},i(i){l||(i&&he(()=>{l&&(o||(o=ie(e,ce,{duration:400},!0)),o.run(1))}),l=!0)},o(i){i&&(o||(o=ie(e,ce,{duration:400},!1)),o.run(0)),l=!1},d(i){i&&v(e),f.d(),i&&o&&o.end()}}}function ss(n,e,t){let{profile:s}=e;return n.$$set=a=>{"profile"in a&&t(0,s=a.profile)},[s]}class as extends Be{constructor(e){super(),Ve(this,e,ss,ts,Oe,{profile:0})}}function rs(n){return{c:q,l:q,m:q,p:q,i:q,o:q,d:q}}function ns(n){let e,t;return e=new as({props:{profile:n[9]}}),{c(){be(e.$$.fragment)},l(s){_e(e.$$.fragment,s)},m(s,a){Ce(e,s,a),t=!0},p:q,i(s){t||(B(e.$$.fragment,s),t=!0)},o(s){D(e.$$.fragment,s),t=!1},d(s){Re(e,s)}}}function os(n){return{c:q,l:q,m:q,p:q,i:q,o:q,d:q}}function rt(n){let e,t,s,a="Error:",r,o,l,c,h='<svg xmlns="http://www.w3.org/2000/svg" class="stroke-current shrink-0 h-6 w-6" fill="none" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>',f,i,k,d;return{c(){e=w("div"),t=w("span"),s=w("span"),s.textContent=a,r=E(),o=De(n[2]),l=E(),c=w("button"),c.innerHTML=h,this.h()},l(m){e=y(m,"DIV",{class:!0});var T=b(e);t=y(T,"SPAN",{class:!0});var _=b(t);s=y(_,"SPAN",{class:!0,"data-svelte-h":!0}),U(s)!=="svelte-13bpzm2"&&(s.textContent=a),r=F(_),o=je(_,n[2]),_.forEach(v),l=F(T),c=y(T,"BUTTON",{class:!0,"data-svelte-h":!0}),U(c)!=="svelte-x9j6qp"&&(c.innerHTML=h),T.forEach(v),this.h()},h(){g(s,"class","font-bold"),g(t,"class","float-left"),g(c,"class","float-right"),g(e,"class","alert alert-error flow-root space-x-3")},m(m,T){X(m,e,T),p(e,t),p(t,s),p(t,r),p(t,o),p(e,l),p(e,c),i=!0,k||(d=ke(c,"click",n[5]),k=!0)},p(m,T){(!i||T&4)&&ze(o,m[2])},i(m){i||(m&&he(()=>{i&&(f||(f=ie(e,ce,{duration:200},!0)),f.run(1))}),i=!0)},o(m){m&&(f||(f=ie(e,ce,{duration:200},!1)),f.run(0)),i=!1},d(m){m&&v(e),m&&f&&f.end(),k=!1,d()}}}function is(n){let e,t,s,a,r,o,l,c,h,f,i,k,d,m='<input type="checkbox" class="drawer-toggle"/> <svg class="swap-off fill-current h-8 w-8" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M64,384H448V341.33H64Zm0-106.67H448V234.67H64ZM64,128v42.67H448V128Z"></path></svg> <svg class="swap-on fill-current h-8 w-8" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><polygon points="400 145.49 366.51 112 256 222.51 145.49 112 112 145.49 222.51 256 112 366.51 145.49 400 256 289.49 366.51 400 400 366.51 289.49 256 400 145.49"></polygon></svg>',T,_,A,le,x,ee,He="Preferences",xe,$,j,Je="Top of The Past Month",z,Ge="Top of The Past Year",M,Ke="Top of All Time",H,We="Following",J,Ze="All Available",qe,O,G,Qe="View as Dots",K,Ye="View as Pictures",W,Xe="View as Names",$e,ue,Ee,Q,et="Log Out",pe,Fe,tt;r=new Yt({props:{sdk:n[3],data:n[4],loading:cs,graphType:n[0],nodeStyle:n[1]}});let P={ctx:n,current:null,token:null,hasCatch:!1,pending:os,then:ns,catch:rs,value:9,blocks:[,,,]};gt(n[3].currentUser.profile(),P),h=new mt({});let R=n[2]&&rt(n);return{c(){e=w("div"),t=w("input"),s=E(),a=w("div"),be(r.$$.fragment),o=E(),l=w("div"),P.block.c(),c=E(),be(h.$$.fragment),f=E(),i=w("div"),R&&R.c(),k=E(),d=w("label"),d.innerHTML=m,T=E(),_=w("div"),A=w("label"),le=E(),x=w("ul"),ee=w("h1"),ee.textContent=He,xe=E(),$=w("select"),j=w("option"),j.textContent=Je,z=w("option"),z.textContent=Ge,M=w("option"),M.textContent=Ke,H=w("option"),H.textContent=We,J=w("option"),J.textContent=Ze,qe=E(),O=w("select"),G=w("option"),G.textContent=Qe,K=w("option"),K.textContent=Ye,W=w("option"),W.textContent=Xe,$e=E(),ue=w("div"),Ee=E(),Q=w("button"),Q.textContent=et,this.h()},l(I){e=y(I,"DIV",{class:!0});var S=b(e);t=y(S,"INPUT",{id:!0,type:!0,class:!0}),s=F(S),a=y(S,"DIV",{class:!0});var L=b(a);_e(r.$$.fragment,L),o=F(L),l=y(L,"DIV",{class:!0});var de=b(l);P.block.l(de),c=F(de),_e(h.$$.fragment,de),de.forEach(v),f=F(L),i=y(L,"DIV",{class:!0});var fe=b(i);R&&R.l(fe),k=F(fe),d=y(fe,"LABEL",{class:!0,for:!0,"data-svelte-h":!0}),U(d)!=="svelte-3obcrk"&&(d.innerHTML=m),fe.forEach(v),L.forEach(v),T=F(S),_=y(S,"DIV",{class:!0});var me=b(_);A=y(me,"LABEL",{for:!0,class:!0}),b(A).forEach(v),le=F(me),x=y(me,"UL",{class:!0});var V=b(x);ee=y(V,"H1",{class:!0,"data-svelte-h":!0}),U(ee)!=="svelte-n7an2l"&&(ee.textContent=He),xe=F(V),$=y(V,"SELECT",{class:!0});var te=b($);j=y(te,"OPTION",{"data-svelte-h":!0}),U(j)!=="svelte-18ovyn3"&&(j.textContent=Je),z=y(te,"OPTION",{"data-svelte-h":!0}),U(z)!=="svelte-1s4lgcp"&&(z.textContent=Ge),M=y(te,"OPTION",{"data-svelte-h":!0}),U(M)!=="svelte-t59ye6"&&(M.textContent=Ke),H=y(te,"OPTION",{"data-svelte-h":!0}),U(H)!=="svelte-1utbkqg"&&(H.textContent=We),J=y(te,"OPTION",{"data-svelte-h":!0}),U(J)!=="svelte-1p6vrpt"&&(J.textContent=Ze),te.forEach(v),qe=F(V),O=y(V,"SELECT",{class:!0});var ge=b(O);G=y(ge,"OPTION",{"data-svelte-h":!0}),U(G)!=="svelte-1ru6mvb"&&(G.textContent=Qe),K=y(ge,"OPTION",{"data-svelte-h":!0}),U(K)!=="svelte-hpqvnh"&&(K.textContent=Ye),W=y(ge,"OPTION",{"data-svelte-h":!0}),U(W)!=="svelte-1arngzx"&&(W.textContent=Xe),ge.forEach(v),$e=F(V),ue=y(V,"DIV",{class:!0}),b(ue).forEach(v),Ee=F(V),Q=y(V,"BUTTON",{class:!0,"data-svelte-h":!0}),U(Q)!=="svelte-m4prcs"&&(Q.textContent=et),V.forEach(v),me.forEach(v),S.forEach(v),this.h()},h(){g(t,"id","my-drawer"),g(t,"type","checkbox"),g(t,"class","drawer-toggle"),g(l,"class","z-20 absolute top-0 right-0 pt-4 pr-4 flex flex-col items-end space-y-3"),g(d,"class","btn btn-circle btn-primary swap swap-rotate"),g(d,"for","my-drawer"),g(i,"class","z-20 absolute bottom-0 right-0 pr-4 pb-4 flex flex-col items-end space-y-3"),g(a,"class","drawer-content relative"),g(A,"for","my-drawer"),g(A,"class","drawer-overlay"),g(ee,"class","text-xl"),j.__value=se.ShortTerm,Y(j,j.__value),z.__value=se.MediumTerm,Y(z,z.__value),M.__value=se.LongTerm,Y(M,M.__value),H.__value=se.Following,Y(H,H.__value),J.__value=se.All,Y(J,J.__value),g($,"class","select select-bordered w-full"),n[0]===void 0&&he(()=>n[6].call($)),G.__value=ve.Dot,Y(G,G.__value),K.__value=ve.Picture,Y(K,K.__value),W.__value=ve.Text,Y(W,W.__value),g(O,"class","select select-bordered w-full"),n[1]===void 0&&he(()=>n[7].call(O)),g(ue,"class","flex-grow"),g(Q,"class","btn btn-primary"),g(x,"class","menu p-4 w-64 md:w-80 space-y-2 h-full bg-base-200 text-base-content flex flex-col"),g(_,"class","drawer-side z-50"),g(e,"class","drawer w-screen h-screen")},m(I,S){X(I,e,S),p(e,t),p(e,s),p(e,a),Ce(r,a,null),p(a,o),p(a,l),P.block.m(l,P.anchor=null),P.mount=()=>l,P.anchor=c,p(l,c),Ce(h,l,null),p(a,f),p(a,i),R&&R.m(i,null),p(i,k),p(i,d),p(e,T),p(e,_),p(_,A),p(_,le),p(_,x),p(x,ee),p(x,xe),p(x,$),p($,j),p($,z),p($,M),p($,H),p($,J),ye($,n[0],!0),p(x,qe),p(x,O),p(O,G),p(O,K),p(O,W),ye(O,n[1],!0),p(x,$e),p(x,ue),p(x,Ee),p(x,Q),pe=!0,Fe||(tt=[ke($,"change",n[6]),ke(O,"change",n[7]),ke(Q,"click",n[8])],Fe=!0)},p(I,[S]){n=I;const L={};S&1&&(L.graphType=n[0]),S&2&&(L.nodeStyle=n[1]),r.$set(L),wt(P,n,S),n[2]?R?(R.p(n,S),S&4&&B(R,1)):(R=rt(n),R.c(),B(R,1),R.m(i,k)):R&&(Le(),D(R,1,1,()=>{R=null}),Ne()),S&1&&ye($,n[0]),S&2&&ye(O,n[1])},i(I){pe||(B(r.$$.fragment,I),B(P.block),B(h.$$.fragment,I),B(R),pe=!0)},o(I){D(r.$$.fragment,I);for(let S=0;S<3;S+=1){const L=P.blocks[S];D(L)}D(h.$$.fragment,I),D(R),pe=!1},d(I){I&&v(e),Re(r),P.block.d(),P.token=null,P=null,Re(h),R&&R.d(),Fe=!1,dt(tt)}}}let cs=null;function ls(n,e,t){let s;nt(n,Se,k=>t(2,s=k));const a=Ue.withUserAuthorization("2ed0e6e8b06842fb854cb15e1690a7b5",window.location.origin+"/dashboard",["user-follow-read","user-top-read"]);a.authenticate();let r={nodes:[],links:[]},o=localStorage.getItem("graphType")??se.ShortTerm,l=localStorage.getItem("nodeStyle")??ve.Dot;const c=()=>ot(Se,s=null,s);function h(){o=at(this),t(0,o)}function f(){l=at(this),t(1,l)}const i=()=>{localStorage.removeItem("spotify-sdk:AuthorizationCodeWithPKCEStrategy:token"),localStorage.removeItem("spotify-sdk:verifier"),window.location.href="/"};return n.$$.update=()=>{n.$$.dirty&1&&localStorage.setItem("graphType",o),n.$$.dirty&2&&localStorage.setItem("nodeStyle",l)},[o,l,s,a,r,c,h,f,i]}class fs extends Be{constructor(e){super(),Ve(this,e,ls,is,Oe,{})}}export{fs as component};
